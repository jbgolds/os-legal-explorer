<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pipeline Trigger</title>
</head>

<body>
    <h1>Pipeline Trigger</h1>
    <p>Fill in the details and click the button below to trigger the end-to-end pipeline task.</p>
    <form id="pipeline-form">
        <label for="court_id">Court ID:</label>
        <input type="text" id="court_id" name="court_id"><br><br>
        <label for="start_date">Start Date (YYYY-MM-DD):</label>
        <input type="text" id="start_date" name="start_date"><br><br>
        <label for="end_date">End Date (YYYY-MM-DD):</label>
        <input type="text" id="end_date" name="end_date"><br><br>
        <label for="limit">Limit:</label>
        <input type="number" id="limit" name="limit" value="100"><br><br>
        <label for="offset">Offset:</label>
        <input type="number" id="offset" name="offset" value="0"><br><br>
        <button type="button" id="trigger-btn">Run Pipeline</button>
    </form>
    <p id="status"></p>

    <script>
        document.getElementById('trigger-btn').addEventListener('click', function () {
            document.getElementById('status').innerText = 'Triggering pipeline...';
            // Retrieve form values
            const courtId = document.getElementById('court_id').value;
            const startDate = document.getElementById('start_date').value;
            const endDate = document.getElementById('end_date').value;
            const limit = document.getElementById('limit').value;
            const offset = document.getElementById('offset').value;

            // Build payload
            const payload = {
                court_id: courtId || null,
                start_date: startDate || null,
                end_date: endDate || null,
                limit: limit ? parseInt(limit) : 100,
                offset: offset ? parseInt(offset) : 0
            };

            fetch('/api/pipeline/trigger', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            })
                .then(response => response.json())
                .then(data => {
                    if (data.job_id) {
                        document.getElementById('status').innerText = 'Pipeline triggered! Job ID: ' + data.job_id;
                    } else {
                        document.getElementById('status').innerText = 'Pipeline triggered, but no job ID returned.';
                    }
                })
                .catch(err => {
                    console.error(err);
                    document.getElementById('status').innerText = 'Error triggering pipeline.';
                });
        });
    </script>
</body>

</html>