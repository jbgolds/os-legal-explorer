<!-- Case Detail Component -->
<div class="card bg-base-100 shadow-xl">
    <!-- Case Header -->
    <div class="card-body">
        <div class="mb-4 pb-4 border-b border-base-300">
            <h2 class="card-title text-2xl">{{ case.case_name }}</h2>
            <div class="flex flex-wrap gap-2 mt-2">
                <div class="badge badge-primary">{{ case.court_name }}</div>
                <div class="badge badge-secondary">{{ case.date_filed|date }}</div>
                {% if case.citation %}
                <div class="badge badge-outline">{{ case.citation }}</div>
                {% endif %}
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs tabs-boxed mb-4">
            <a class="tab tab-active" data-tab="opinion">Opinion Text</a>
            <a class="tab" data-tab="citation-map">Citation Network</a>
        </div>

        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Opinion Text Tab -->
            <div id="opinion-content" class="prose max-w-none">
                {% if case.html %}
                <div class="mockup-browser border border-base-300">
                    <div class="mockup-browser-toolbar">
                        <div class="input border border-base-300">{{ case.case_name }}</div>
                    </div>
                    <div class="px-4 py-8 border-t border-base-300 bg-base-200">
                        <div class="whitespace-pre-wrap font-serif leading-relaxed">
                            {{ case.html|safe }}
                        </div>
                    </div>
                </div>
                {% elif case.plain_text %}
                <div class="mockup-browser border border-base-300">
                    <div class="mockup-browser-toolbar">
                        <div class="input border border-base-300">{{ case.case_name }}</div>
                    </div>
                    <div class="px-4 py-8 border-t border-base-300 bg-base-200">
                        <div class="whitespace-pre-wrap font-serif leading-relaxed">
                            {{ case.plain_text }}
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="alert alert-warning">
                    <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                    <span>No opinion text available for this case.</span>
                </div>
                {% endif %}
            </div>

            <!-- Citation Map Tab (hidden by default) -->
            <div id="citation-map-content" class="hidden">
                <div id="citation-network-wrapper">
                    <!-- Citation network will be loaded here -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Tab Switching Script -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content > div');

        tabs.forEach(tab => {
            tab.addEventListener('click', function () {
                // Remove active class from all tabs
                tabs.forEach(t => t.classList.remove('tab-active'));

                // Add active class to clicked tab
                this.classList.add('tab-active');

                // Hide all tab content
                tabContents.forEach(content => content.classList.add('hidden'));

                // Show selected tab content
                const tabId = this.dataset.tab;
                if (tabId === 'opinion') {
                    document.getElementById('opinion-content').classList.remove('hidden');
                } else if (tabId === 'citation-map') {
                    document.getElementById('citation-map-content').classList.remove('hidden');

                    // Load citation map if not already loaded
                    if (!document.getElementById('citation-network-wrapper').dataset.loaded) {
                        // Load the citation network
                        const caseId = '{{ case.id }}';
                        fetch(`/api/opinion/${caseId}/citations/component`)
                            .then(response => response.text())
                            .then(html => {
                                document.getElementById('citation-network-wrapper').innerHTML = html;
                                document.getElementById('citation-network-wrapper').dataset.loaded = true;
                            })
                            .catch(error => {
                                console.error('Error loading citation network:', error);
                                document.getElementById('citation-network-wrapper').innerHTML = `
                                    <div class="alert alert-error">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                        <span>Error loading citation network. Please try again later.</span>
                                    </div>
                                `;
                            });
                    }
                }
            });
        });
    });
</script>